# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the "main" branch
  push:
  pull_request:

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  build-env:
    strategy:
      matrix:
        target: [ development, staging, production ]
    name: production build on main branch
    uses: ./.github/workflows/build-handler.yml
    with:
      target: ${{ matrix.target }}
      tag-version: ${{ vars.TAG_VERSION }}
      branch-name: ${{ github.head_ref || github.ref_name }}
    secrets: inherit

  build-staging:
      if: github.event_name != 'pull_request' || github.event.pull_request.merged == false
      name: stating build on ${{ github.head_ref || github.ref_name }}
      uses: ./.github/workflows/build.yml
      with:
        target: 'staging'
        tag-version: ${{ vars.TAG_VERSION }}
      secrets: inherit

  build-development:
    if: github.event_name != 'pull_request' || github.event.pull_request.merged == false
    name: development build on ${{ github.head_ref || github.ref_name }}
    uses: ./.github/workflows/build.yml
    with:
      target: 'development'
      tag-version: ${{ vars.TAG_VERSION }}
    secrets: inherit
    
    # The type of runner that the job will run on
    
